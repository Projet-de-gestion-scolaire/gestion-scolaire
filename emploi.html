<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Emploi du temps</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Couleurs personnalis√©es (du code des professeurs) */
        .bg-primary-blue { background-color: #0F172A; }
        .text-primary-blue { color: #0F172A; }
        .bg-accent-blue { background-color: #2563EB; }
        .hover\:bg-accent-blue:hover { background-color: #2563EB; }
        .bg-accent-blue-dark { background-color: #1D4ED8; }
        .hover\:bg-accent-blue-dark:hover { background-color: #1D4ED8; }
        .bg-accent-green { background-color: #10B981; }
        .hover\:bg-accent-green-dark:hover { background-color: #059669; }
        .bg-accent-yellow { background-color: #FBBF24; }
        .hover\:bg-accent-yellow-dark:hover { background-color: #F59E0B; }
        .bg-accent-red { background-color: #EF4444; }
        .hover\:bg-accent-red-dark:hover { background-color: #DC2626; }
        .bg-accent-cyan { background-color: #06B6D4; }
        .hover\:bg-accent-cyan-dark:hover { background-color: #0891B2; }
        .bg-accent-purple { background-color: #8B5CF6; }
        .hover\:bg-accent-purple-dark:hover { background-color: #7C3AED; }
        .bg-accent-orange { background-color: #F97316; }
        .hover\:bg-accent-orange-dark:hover { background-color: #EA580C; }

        /* Styles sp√©cifiques √† la sidebar pour harmoniser avec le code professeur */
        #main-sidebar nav a:not(.bg-accent-blue) { color: #4B5563; font-weight: 600; }
        #main-sidebar nav a.group:hover span.group-hover\:text-white { color: white !important; }
        #main-sidebar nav a.group:hover span.text-gray-600 { color: white !important; }

        /* Styles pour le header d√©fil√© */
        .scrolled-header {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Styles pour la sidebar sur mobile */
        #main-sidebar {
            transform: translateX(-100%);
        }

        #main-sidebar.active {
            transform: translateX(0);
        }

        /* Styles pour l'overlay de la sidebar */
        #sidebar-overlay {
            display: none;
        }

        #sidebar-overlay.active {
            display: block;
            opacity: 1; /* Rendre l'overlay visible */
        }

        /* Pour s'assurer que la sidebar est toujours visible sur les √©crans plus grands que md */
        @media (min-width: 768px) {
            #main-sidebar {
                transform: translateX(0);
            }
            #sidebar-overlay {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
    <header id="main-header" class="bg-white shadow fixed top-0 left-0 right-0 z-50 flex items-center justify-between py-2 px-4 transition-all duration-300 ease-in-out">
        <div class="flex items-center space-x-4">
            <img src="logo.png" alt="Logo √©cole" class="w-12 h-12 object-contain" />
            <h1 class="text-xl font-bold text-primary-blue">Gestion Administrative</h1>
        </div>
        <button id="menu-toggle" class="md:hidden text-gray-600 hover:text-accent-blue focus:outline-none">
            <i class="fas fa-bars text-xl"></i>
        </button>
        <div class="flex items-center space-x-4">
            <a href="notification.html" class="relative text-gray-600 hover:text-accent-cyan"><i class="fas fa-bell text-xl"></i>
                <span id="unread-notification-count" class="absolute -top-2 -right-2 text-xs bg-accent-red text-white rounded-full w-5 h-5 flex items-center justify-center">0</span>
            </a>
            <div class="relative">
                <button id="user-toggle" class="flex items-center space-x-1 text-gray-700 hover:text-accent-green focus:outline-none">
                    <i class="fas fa-user-circle text-2xl"></i><span>N√®n√® Diallo</span><i class="fas fa-caret-down text-sm"></i>
                </button>
                <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-40 bg-white border rounded shadow-lg z-50">
                    <a href="#" class="block px-4 py-2 text-sm hover:bg-green-100">Profil</a>
                    <a href="#" class="block px-4 py-2 text-sm hover:bg-green-100">D√©connexion</a>
                </div>
            </div>
            <a href="parametres.html" class="text-gray-600 hover:text-primary-blue"><i class="fas fa-cog text-xl"></i></a>
        </div>
    </header>

    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden transition-opacity duration-300 ease-in-out"></div>

    <div class="flex max-w-7xl mx-auto pt-24 px-4 gap-6">
        <aside id="main-sidebar" class="bg-white w-64 min-h-screen p-4 shadow-md fixed top-0 left-0 h-full transform -translate-x-full md:relative md:translate-x-0 md:block transition-transform duration-300 ease-in-out z-40">
            <h2 class="text-xl font-semibold mb-4 text-primary-blue">Tableau de bord - Menu</h2>
            <nav class="space-y-2">
                <a href="index.html" class="flex items-center py-2 px-4 rounded transition-colors duration-200 group hover:bg-accent-blue">
                    <span class="text-xl mr-3 text-gray-600 group-hover:text-white">üè†</span>
                    <span class="hidden md:inline font-semibold text-gray-700 group-hover:text-white">Accueil</span>
                </a>
                <a href="eleve.html" class="flex items-center py-2 px-4 rounded transition-colors duration-200 group hover:bg-accent-blue">
                    <span class="text-xl mr-3 text-gray-600 group-hover:text-white">üë®‚Äçüéì</span>
                    <span class="hidden md:inline font-semibold text-gray-700 group-hover:text-white">√âl√®ves</span>
                </a>
                <a href="classes.html" class="flex items-center py-2 px-4 rounded transition-colors duration-200 group hover:bg-accent-blue">
                    <span class="text-xl mr-3 text-gray-600 group-hover:text-white">üìö</span>
                    <span class="hidden md:inline font-semibold text-gray-700 group-hover:text-white">Classes & Mati√®res</span>
                </a>
                <a href="emploi.html" class="flex items-center py-2 px-4 rounded bg-accent-blue text-white font-semibold">
                    <span class="text-xl mr-3 text-white">üìÖ</span>
                    <span class="hidden md:inline text-white">Emploi du temps</span>
                </a>
                <a href="professeur.html" class="flex items-center py-2 px-4 rounded transition-colors duration-200 group hover:bg-accent-blue">
                    <span class="text-xl mr-3 text-gray-600 group-hover:text-white">üë®‚Äçüè´</span>
                    <span class="hidden md:inline font-semibold text-gray-700 group-hover:text-white">Professeurs</span>
                </a>
                <a href="notification.html" class="flex items-center py-2 px-4 rounded transition-colors duration-200 group hover:bg-accent-blue">
                    <span class="text-xl mr-3 text-gray-600 group-hover:text-white">üîî</span>
                    <span class="hidden md:inline font-semibold text-gray-700 group-hover:text-white">Notifications</span>
                </a>
                <a href="parametres.html" class="flex items-center py-2 px-4 rounded transition-colors duration-200 group hover:bg-accent-blue">
                    <span class="text-xl mr-3 text-gray-600 group-hover:text-white">‚öô</span>
                    <span class="hidden md:inline font-semibold text-gray-700 group-hover:text-white">Param√®tres</span>
                </a>
            </nav>
        </aside>

        <main class="flex-1">
            <h2 class="text-2xl font-bold mb-6 text-primary-blue">Gestion de l'emploi du temps</h2>

            <form id="form-emploi" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 bg-white p-6 rounded shadow mb-6">
                <input type="text" id="matiere" placeholder="Mati√®re" required class="border border-gray-300 rounded px-4 py-2" />
                <input type="text" id="classe" placeholder="Classe" required class="border border-gray-300 rounded px-4 py-2" />
                <input type="text" id="professeur" placeholder="Professeur" required class="border border-gray-300 rounded px-4 py-2" />
                <select id="jour" required class="border border-gray-300 rounded px-4 py-2">
                    <option value="">Jour</option>
                    <option>Lundi</option>
                    <option>Mardi</option>
                    <option>Mercredi</option>
                    <option>Jeudi</option>
                    <option>Vendredi</option>
                    <option>Samedi</option>
                </select>
                <input type="time" id="heure-debut" required class="border border-gray-300 rounded px-4 py-2" />
                <input type="time" id="heure-fin" required class="border border-gray-300 rounded px-4 py-2" />
                <div class="col-span-full flex gap-2 mt-2">
                    <button type="submit" id="btn-submit-emploi" class="bg-accent-blue hover:bg-accent-blue-dark text-white px-4 py-2 rounded">Ajouter</button>
                    <button type="button" id="btn-cancel-emploi" class="bg-gray-400 text-white px-4 py-2 rounded hidden">Annuler</button>
                </div>
            </form>

            <div id="message-box" class="hidden"></div>

            <table class="w-full bg-white border border-gray-300 shadow text-left">
                <thead class="bg-accent-blue text-white">
                    <tr>
                        <th class="py-2 px-4 border">Mati√®re</th>
                        <th class="py-2 px-4 border">Classe</th>
                        <th class="py-2 px-4 border">Professeur</th>
                        <th class="py-2 px-4 border">Jour</th>
                        <th class="py-2 px-4 border">D√©but</th>
                        <th class="py-2 px-4 border">Fin</th>
                        <th class="py-2 px-4 border">Actions</th>
                    </tr>
                </thead>
                <tbody id="emploi-table-body"></tbody>
            </table>
        </main>
    </div>

    <footer class="mt-10 bg-primary-blue text-white text-center py-4 text-sm">
        <p>&copy; 2025 √âcole X - Tous droits r√©serv√©s</p>
    </footer>

    <script>
        // --- D√©finition des √©l√©ments du DOM (Importants pour toutes les pages) ---
        const mainHeader = document.getElementById("main-header");
        const menuToggle = document.getElementById("menu-toggle");
        const mainSidebar = document.getElementById("main-sidebar");
        const sidebarOverlay = document.getElementById("sidebar-overlay");
        const userToggle = document.getElementById("user-toggle");
        const userDropdown = document.getElementById("user-dropdown");
        const unreadNotificationCount = document.getElementById("unread-notification-count");

        // --- Fonctions utilitaires de simulation (pour le localStorage et les messages) ---
        // Ces fonctions simulent un backend ou une gestion de donn√©es plus complexe.
        // Dans une application r√©elle, elles communiqueraient avec une API.

        const getAppSettings = () => JSON.parse(localStorage.getItem("appSettings")) || {};
        const setAppSettings = (data) => localStorage.setItem("appSettings", JSON.stringify(data));

        const getUsers = () => JSON.parse(localStorage.getItem("users")) || [];
        const setUsers = (data) => localStorage.setItem("users", JSON.stringify(data));

        const getTasks = () => JSON.parse(localStorage.getItem("tasks")) || [];
        const setTasks = (data) => localStorage.setItem("tasks", JSON.stringify(data));

        const getNotifications = () => JSON.parse(localStorage.getItem("notifications")) || [];
        const setNotifications = (data) => localStorage.setItem("notifications", JSON.stringify(data));

        const getRecentActivities = () => JSON.parse(localStorage.getItem("recentActivities")) || [];
        const setRecentActivities = (data) => localStorage.setItem("recentActivities", JSON.stringify(data));

        const messageBox = document.getElementById("message-box");

        /**
         * Affiche un message √† l'utilisateur.
         * @param {string} text - Le texte du message.
         * @param {'green'|'red'|'blue'|'yellow'} type - Le type de message pour la couleur.
         */
        function showMessage(text, type = "green") {
            messageBox.textContent = text;
            messageBox.className = `mt-4 p-2 rounded font-semibold `;
            switch (type) {
                case 'green':
                    messageBox.classList.add('bg-green-100', 'text-green-700');
                    break;
                case 'red':
                    messageBox.classList.add('bg-red-100', 'text-red-700');
                    break;
                case 'blue':
                    messageBox.classList.add('bg-blue-100', 'text-blue-700');
                    break;
                case 'yellow':
                    messageBox.classList.add('bg-yellow-100', 'text-yellow-700');
                    break;
                default:
                    messageBox.classList.add('bg-gray-100', 'text-gray-700');
                    break;
            }
            messageBox.classList.remove("hidden");
            setTimeout(() => messageBox.classList.add("hidden"), 3000); // Cache le message apr√®s 3 secondes
        }

        /**
         * Enregistre une activit√© dans le journal des activit√©s r√©centes.
         * @param {string} description - Description de l'activit√©.
         */
        function logActivity(description) {
            const activities = getRecentActivities();
            const now = new Date();
            const timestamp = now.toLocaleDateString('fr-FR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            const newActivity = {
                id: Date.now(),
                description,
                timestamp
            };
            activities.unshift(newActivity); // Ajoute au d√©but pour avoir les plus r√©centes en premier
            setRecentActivities(activities.slice(0, 5)); // Garde seulement les 5 derni√®res activit√©s
        }

        // --- Fonctions communes du Header et Sidebar (r√©utilisables) ---

        function updateUnreadNotificationCount() {
            const notifications = getNotifications();
            const unreadCount = notifications.filter(n => !n.read).length;
            unreadNotificationCount.textContent = unreadCount > 0 ? unreadCount : '0';
            if (unreadCount > 0) {
                unreadNotificationCount.classList.remove('hidden');
            } else {
                unreadNotificationCount.classList.add('hidden');
            }
        }

        // Sidebar et Overlay Toggle
        if (menuToggle && mainSidebar && sidebarOverlay) {
            menuToggle.addEventListener("click", () => {
                mainSidebar.classList.toggle("active");
                sidebarOverlay.classList.toggle("active");
            });

            sidebarOverlay.addEventListener("click", () => {
                mainSidebar.classList.remove("active");
                sidebarOverlay.classList.remove("active");
            });
        }

        // User Dropdown Toggle
        if (userToggle && userDropdown) {
            userToggle.addEventListener("click", (event) => {
                userDropdown.classList.toggle("hidden");
                event.stopPropagation();
            });

            document.addEventListener("click", (event) => {
                if (!userDropdown.contains(event.target) && !userToggle.contains(event.target)) {
                    userDropdown.classList.add("hidden");
                }
            });
        }


        // Header scroll effect
        if (mainHeader) {
            window.addEventListener('scroll', () => {
                if (window.scrollY > 0) {
                    mainHeader.classList.add('scrolled-header');
                } else {
                    mainHeader.classList.remove('scrolled-header');
                }
            });
        }


        // --- Logique sp√©cifique √† l'emploi du temps ---
        const formEmploi = document.getElementById("form-emploi");
        const emploiTableBody = document.getElementById("emploi-table-body");
        const btnSubmitEmploi = document.getElementById("btn-submit-emploi");
        const btnCancelEmploi = document.getElementById("btn-cancel-emploi");

        let editingId = null;

        // Fonctions de persistance des donn√©es pour l'emploi du temps
        const getCreneaux = () => JSON.parse(localStorage.getItem("creneaux")) || [];
        const setCreneaux = data => localStorage.setItem("creneaux", JSON.stringify(data));

        /**
         * Affiche la table des cr√©neaux horaires.
         */
        const renderTable = () => {
            const creneaux = getCreneaux();
            emploiTableBody.innerHTML = '';

            if (creneaux.length === 0) {
                emploiTableBody.innerHTML = '<tr><td colspan="7" class="py-4 text-center text-gray-500">Aucun cr√©neau enregistr√©.</td></tr>';
                return;
            }

            // Tri par jour (Lundi √† Samedi) puis par heure de d√©but
            const joursOrdre = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
            creneaux.sort((a, b) => {
                const jourA = joursOrdre.indexOf(a.jour);
                const jourB = joursOrdre.indexOf(b.jour);
                if (jourA !== jourB) {
                    return jourA - jourB;
                }
                return a.heureDebut.localeCompare(b.heureDebut);
            });

            creneaux.forEach(c => {
                const row = document.createElement("tr");
                row.className = "border-b border-gray-200 last:border-b-0"; /* Style de bordure ajout√© */
                row.innerHTML = `
                    <td class="py-2 px-4">${c.matiere}</td>
                    <td class="py-2 px-4">${c.classe}</td>
                    <td class="py-2 px-4">${c.professeur}</td>
                    <td class="py-2 px-4">${c.jour}</td>
                    <td class="py-2 px-4">${c.heureDebut}</td>
                    <td class="py-2 px-4">${c.heureFin}</td>
                    <td class="py-2 px-4 space-x-2">
                        <button data-id="${c.id}" class="btn-modifier bg-accent-yellow hover:bg-accent-yellow-dark text-white px-2 py-1 rounded text-sm"><i class="fas fa-edit"></i> Modifier</button>
                        <button data-id="${c.id}" class="btn-supprimer bg-accent-red hover:bg-accent-red-dark text-white px-2 py-1 rounded text-sm"><i class="fas fa-trash-alt"></i> Supprimer</button>
                    </td>
                `;
                emploiTableBody.appendChild(row);
            });
        };

        /**
         * R√©initialise le formulaire d'emploi du temps.
         */
        const resetEmploiForm = () => {
            formEmploi.reset();
            editingId = null;
            btnSubmitEmploi.textContent = "Ajouter";
            btnSubmitEmploi.classList.remove("bg-accent-yellow", "hover:bg-accent-yellow-dark");
            btnSubmitEmploi.classList.add("bg-accent-blue", "hover:bg-accent-blue-dark");
            btnCancelEmploi.classList.add("hidden");
        };

        /**
         * G√®re la soumission du formulaire d'emploi du temps (ajout ou modification).
         */
        formEmploi.addEventListener("submit", e => {
            e.preventDefault();

            const matiere = document.getElementById("matiere").value.trim();
            const classe = document.getElementById("classe").value.trim();
            const professeur = document.getElementById("professeur").value.trim();
            const jour = document.getElementById("jour").value;
            const heureDebut = document.getElementById("heure-debut").value;
            const heureFin = document.getElementById("heure-fin").value;

            if (!matiere || !classe || !professeur || !jour || !heureDebut || !heureFin) {
                showMessage("Tous les champs sont obligatoires.", "red");
                return;
            }

            let creneaux = getCreneaux();

            if (editingId !== null) {
                // Mode modification
                const index = creneaux.findIndex(c => c.id === editingId);
                if (index > -1) {
                    creneaux[index] = { id: editingId, matiere, classe, professeur, jour, heureDebut, heureFin };
                    showMessage("Cr√©neau modifi√© avec succ√®s !", "green");
                    logActivity(`Cr√©neau horaire modifi√©: ${matiere} en ${classe} le ${jour}`);
                }
            } else {
                // Mode ajout
                const newCreneau = {
                    id: Date.now(),
                    matiere, classe, professeur, jour, heureDebut, heureFin
                };
                creneaux.push(newCreneau);
                showMessage("Cr√©neau ajout√© !", "green");
                logActivity(`Nouveau cr√©neau horaire ajout√©: ${matiere} pour ${classe} le ${jour}`);
            }

            setCreneaux(creneaux);
            renderTable();
            resetEmploiForm();
        });

        // G√®re l'annulation de la modification
        btnCancelEmploi.addEventListener("click", resetEmploiForm);

        /**
         * G√®re la suppression d'un cr√©neau.
         * @param {number} id - L'ID du cr√©neau √† supprimer.
         */
        const supprimerCreneau = id => {
            if (confirm("Voulez-vous vraiment supprimer ce cr√©neau ?")) {
                let creneaux = getCreneaux();
                const creneauToDelete = creneaux.find(c => c.id === id);
                if (creneauToDelete) {
                    creneaux = creneaux.filter(c => c.id !== id);
                    setCreneaux(creneaux);
                    renderTable();
                    showMessage(`Cr√©neau "${creneauToDelete.matiere} en ${creneauToDelete.classe}" supprim√©.`, "red");
                    logActivity(`Cr√©neau horaire supprim√©: ${creneauToDelete.matiere} en ${creneauToDelete.classe}`);
                }
            }
        };

        /**
         * G√®re le chargement d'un cr√©neau dans le formulaire pour modification.
         * @param {number} id - L'ID du cr√©neau √† modifier.
         */
        const modifierCreneau = id => {
            const creneaux = getCreneaux();
            const c = creneaux.find(c => c.id === id);
            if (c) {
                document.getElementById("matiere").value = c.matiere;
                document.getElementById("classe").value = c.classe;
                document.getElementById("professeur").value = c.professeur;
                document.getElementById("jour").value = c.jour;
                document.getElementById("heure-debut").value = c.heureDebut;
                document.getElementById("heure-fin").value = c.heureFin;
                editingId = id;

                btnSubmitEmploi.textContent = "Modifier";
                btnSubmitEmploi.classList.remove("bg-accent-blue", "hover:bg-accent-blue-dark");
                btnSubmitEmploi.classList.add("bg-accent-yellow", "hover:bg-accent-yellow-dark");
                btnCancelEmploi.classList.remove("hidden");
                logActivity(`Chargement du cr√©neau pour modification: ${c.matiere} en ${c.classe}`);
            }
        };

        // --- D√©l√©gation d'√©v√©nements pour les boutons Modifier/Supprimer ---
        emploiTableBody.addEventListener("click", (event) => {
            if (event.target.classList.contains("btn-modifier")) {
                const id = parseInt(event.target.dataset.id);
                modifierCreneau(id);
            } else if (event.target.classList.contains("btn-supprimer")) {
                const id = parseInt(event.target.dataset.id);
                supprimerCreneau(id);
            }
        });


        // --- Initialisation de la page ---
        document.addEventListener("DOMContentLoaded", () => {
            renderTable();
            updateUnreadNotificationCount();
        });
    </script>
</body>
</html>